<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="script.js"></script>
        
        <!--link rel="stylesheet" href="style.css" /-->
        <meta charset="UTF-8" />
        <meta name="viewport" 
              content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>
    <body>
        <!-- Here a loader is created which 
             loads till response comes -->
        
        <div class="d-flex justify-content-center">
            <div class="spinner-border" 
                 role="status" id="loading">
                <span class="sr-only">Loading...</span>
            </div>
        </div>

        <form id = 'login'>
            <div>
                <label for="idEspecialidad">id</label>
                <input type="text" name="idEspecialidad" id="idEspecialidad">
            </div>

            <div>
                <label for="nombre">nombre</label>
                <input type="text" name="nombre" id="nombre">
            </div>

            <button type="submit" id="btn"> submit</button>
        </form>

        <script>
            const formulario = document.getElementById('login');
            const postURL = "http://192.168.1.107:5000/especialidades/";
            
            const postData = document.getElementById("login");

            //agarra data de los inputs y los convierte en JSON para enviarlos con fetch en forma de post
            postData.addEventListener('submit',async function(e){
                e.preventDefault();
                
                const formData = new FormData(postData).entries()
                
                const response = await fetch(postURL,{
                    mode: 'cors',
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(Object.fromEntries(formData))
                });
                
                const result = await response.json();
                console.log(result);
            });
                
                
            
            /*
            //genera un JSON agarrando el valor de los datos ingresados en los inputs
            document.addEventListener('DOMContentLoaded',() => {
                document.getElementById("btn").addEventListener('click',postData)
            });
            
                const data = { 
                    especialidades: {
                            idEspecialidad : parseInt(document.getElementById('idEspecialidad').value),
                            nombre : document.getElementById('nombre').value
                        }
                }

                
                console.log(typeof(data));
                
                
                fetch(postURL,{
                    mode: 'cors',
                    method: 'post',
                    body:   {
                                especialidades : {
                                    idEspecialidad: parseInt(document.getElementById('idEspecialidad').value),
                                    nombre : document.getElementById('nombre').value
                                }
                            }

                }).then(function(response){
                    return response.text();
                }).then(function(text){
                    console.log(text);
                    
                }).catch(function(error){
                    console.error(error);
                });
            }
            */


            
            /*OBSOLETO
            formulario.addEventListener('submit', function(e){
                //evita recargar la pagina o cambiar
                e.preventDefault();

                const data = new FormData(e.target);
                //console.log(JSON.stringify(Object.fromEntries(data.entries())));

                fetch(postURL,{
                    mode: 'cors',
                    method: 'post',
                    body:data
                }).then(function(response){
                    return response.text();
                }).then(function(text){
                    console.log(text);
                }).catch(function(error){
                    console.error(error);
                });
            });*/
        </script>

        <h1>Registered Employees</h1>
        <!-- table for showing data -->
        <table id="especialidades"></table>
    </body>
</html>